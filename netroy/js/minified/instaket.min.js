var Instaket=function(a,b){this.defaults={url:"ws://websockets.inagist.com:18010/websockets_stream",retweets:false,trackwords:false,trackwords_with_stat:false,toplinks:false,toptweets:false,toptweets_m:false,toptrends:false,level:3,archive_limit:undefined,live:true,debug:false};this.settings=$.extend(this.defaults,b);this.userid=a;this.ws;this.chandler=100;this.callbacks=[]};Instaket.prototype={connect:function(){var b=this;if("WebSocket" in window){var a=new WebSocket(this.settings.url);a.onopen=function(){b.onopen.apply(b,arguments)};a.onmessage=function(){b.onmessage.apply(b,arguments)};a.onclose=function(){b.onclose.apply(b,arguments)};a.onerror=function(){b.onerror.apply(b,arguments)};this.ws=a}else{this.ws={};b.nosocket.apply(b,arguments)}},disconnect:function(){this.ws.close()},onopen:function(a){if(typeof this.userid=="string"){this.ws.send("stream "+this.userid)}$(this).trigger("connection_opened",a)},onmessage:function(b){if(this.settings.debug){console.log(b.data)}var c=JSON.parse(b.data);if(c.error){$(this).trigger("error",c)}else{if(c.status=="connected"){if(this.settings.trackwords){this.ws.send("trackwords "+this.userid)}if(this.settings.trackwords_with_stat){this.ws.send("trackwordsstat "+this.userid)}if(this.settings.toptrends){this.ws.send("toptrends "+this.userid+" "+this.settings.level)}if(this.settings.toplinks){this.ws.send("toplinks "+this.userid+" "+this.settings.level)}if(this.settings.toptweets){this.ws.send("toptweets "+this.userid+" "+this.settings.level)}if(this.settings.toptweets_m){this.ws.send("toptweets "+this.userid+" "+this.settings.level+" tweet_cache")}if(this.settings.archive_limit){this.ws.send("setlimit tweet_archived_limit "+this.settings.archive_limit)}if(this.settings.retweets){this.ws.send("retweets_on")}else{this.ws.send("retweets_off")}if(this.settings.live){this.ws.send("live_on")}else{this.ws.send("live_off")}$(this).trigger("user_connected",c)}else{if(c.type=="status"){$(this).trigger("status",c.status)}else{if(c.type=="trackwords"){$(this).trigger("trackwords",[c.trackwords])}else{if(c.type=="toptrends"){$(this).trigger("toptrends",[c.toptrends])}else{if(c.type=="toplinks"){$(this).trigger("toplinks",[c.toplinks])}else{if(c.type=="toptweets"){$(this).trigger("toptweets",[c.toptweets])}else{if(typeof c.type!="undefined"){var a=c.type;if(typeof c[a]!="undefined"){if(this.hasCallback(c[a].corelation)){this.doCallback(c[a].corelation,c[a])}else{$(this).trigger(a,c[a])}}else{$(this).trigger(a,c)}}else{$(this).trigger("custom_event",c)}}}}}}}}},onclose:function(a){$(this).trigger("connection_closed",a)},onerror:function(a){$(this).trigger("connection_errored",a)},hasCallback:function(a){return jQuery.isFunction(this.callbacks[a])},doCallback:function(a,b){if(jQuery.isFunction(this.callbacks[a])){var c=this.callbacks[a];delete this.callbacks[a];c(b)}},addCallback:function(b){var a="cback_"+this.chandler++;this.callbacks[a]=b;return a},nosocket:function(a){$(this).trigger("nosocket",a)},lookuptweet:function(b,a){var c="tweet "+b;if(typeof a=="function"){c+=" "+this.addCallback(a)}else{if(typeof a!="undefined"){c+=" "+a}}this.ws.send(c)},lookupurl:function(b,a){var c="url "+b;if(typeof a=="function"){c+=" "+this.addCallback(a)}else{if(typeof a!="undefined"){c+=" "+a}}this.ws.send(c)},lookuptweet_stat:function(b,a){var c="tweetstat "+b;if(typeof a=="function"){c+=" "+this.addCallback(a)}else{if(typeof a!="undefined"){c+=" "+a}}this.ws.send(c)},retweets_on:function(){this.settings.retweets=true;this.ws.send("retweets_on")},retweets_off:function(){this.settings.retweets=false;this.ws.send("retweets_off")},live_on:function(){this.settings.live=true;this.ws.send("live_on")},live_off:function(){this.settings.live=false;this.ws.send("live_off")},search:function(a){if(typeof a=="object"){if(typeof a.callback=="function"){a.corelation=this.addCallback(a.callback)}this.ws.send("esearch "+JSON.stringify(a))}else{this.ws.send("search "+a)}},};