(function(){window.params={};var d=window.location.search.substr(1).split("&");for(var g=0,f=d.length;g<f;g++){var e=d[g];if(e.length==0){continue}var c=e.split("=");if(c.length==0||c[0].length==0){continue}window.params[c[0]]=c[1]||null}window.makeurl=function(a){var b={},i=[];for(var h in window.params){b[h]=window.params[h]}for(var h in a){b[h]=a[h]}for(var h in b){i.push(h+(!!b[h]?"="+b[h]:""))}return window.baseurl+"?"+i.join("&")}})();$(function(){window.isHome=($("#tweets").length==0);if(window.widgetUrl){window.tweetUrl=window.makeurl({r:"main/widgettweets",user:window.user,list:window.list,hours:window.hours})}else{if(window.noautorefresh){window.tweetUrl=""}else{window.tweetUrl=window.makeurl({r:"main/tweets",user:window.user,list:window.list,hours:window.hours})}}window.portalUrl=window.makeurl({r:"main/portals",count:(isHome?3:3)})});function linkify(a){if(typeof a!="string"){return""}a=a.replace(/(https?:\/\/[^\s]+)/i,"<a href='$1' class='ext' target='_blank' rel='nofollow'>$1</a>");a=a.replace(/(^|[\s,\.])@([A-Za-z0-9_]+)/g,"$1@<a href=\"http://twitter.com/$2\" target='_blank'>$2</a>");a=a.replace(/(^|[\s,\.])#([A-Za-z0-9_]+)/g,"$1#<a href=\"http://search.twitter.com/search?had_popular=true&q=$2\" target='_blank'>$2</a>");return a}function toggleTweetByID(b){$("div.preview[id!=pre"+b+"]").hide();$("div.body[id!=tw"+b+"]").removeClass("selected");var a=$("div#pre"+b);$("div.loader",a).show();return a}function postToggle(g,c){var b=$("div#tw"+g);if(c.css("display")=="none"){b.removeClass("selected")}else{b.addClass("selected");var f=$("#pre"+g).offset().top;var e=$(document).scrollTop()+$(window).height()-20;if(f>e){$("html,body").scrollTop(f-$(window).height()+$("#tw"+g).height())}if(c.attr("rel")=="done"){$("div.loader",c).hide();return}var d={r:"main/lookup",id:g};var a=$("td.text a.url",b).attr("href");if(a.length>0&&a.indexOf("http://")==0){d.url=escape(a)}$.get(window.makeurl(d),function(h){$("div.loader",c).hide();$(":not(:first-child)",c).remove();c.append(h);$("span.replybt",c).click(replyTweet)},"html");c.attr("rel","done")}}function reloadTweet(){$.get(tweetUrl,function(a){if(a.length>10){$("#leftpane").html(a);initTweetUI()}},"html")}function reloadPortal(){$.get(portalUrl,function(a){if(a.length>10){$("#rightpane").html(a);initPortalUI()}},"html")}function handleTap(c){if($(c.target)[0].tagName.toLowerCase()=="a"||$(c.target.parentNode)[0].tagName.toLowerCase()=="a"){if($(c.target).hasClass("ext")){c.preventDefault();var a=$(c.target).parentsUntil("div.body")[0];$(a).click()}else{c.stopPropagation()}return}var d=$("span.prevbt,span.respbt",$(this)).attr("id").replace(/^(prev|resp)_/,"");var b=toggleTweetByID(d);b.toggle();postToggle(d,b)}function replyTweet(b){b.preventDefault();if(typeof window.loggedinuser=="undefined"){modal.info("not logged in... login with twitter to post reply and retweet");window.location="/login";return false}var a=$(this).parentsUntil("div.body,div.msg,div.tweetcontent").last().parent();var d=a.attr("id").substr(2);var c=$("span.user",a).html();modal.prompt("replying to "+c,"@"+c+" ",function(e){modal.loader.show("posting your reply");_gaq.push(['_trackSocial', 'twitter', 'reply', d]);$.post(baseurl+"reply.php",{tweet_id:d,tweet_text:e},function(f){if(f.response==200){modal.info("reply posted")}else{if(f.response==400){modal.info("not logged in")}else{modal.info("some issue posting your reply")}}modal.loader.hide()})});return false}function retweet(b){b.preventDefault();if(typeof window.loggedinuser=="undefined"){modal.info("not logged in... login with twitter to post reply and retweet");window.location="/login";return false}var a=$(this).parentsUntil("div.body,div.tweetcontent").last().parent();var c=a.attr("id").substr(2);modal.confirm("do you wanna retweet this?",function(){modal.loader.show("posting the retweet");_gaq.push(['_trackSocial', 'twitter', 'retweet', c]);$.post(baseurl+"retweet.php?tweet_id="+c,function(d){if(d.response==200){modal.info("retweet posted")}else{if(d.response==400){modal.info("not logged in")}else{modal.info("some issue posting your reply")}}modal.loader.hide()})});return false}function showmore(g){g.preventDefault();$("div.child").slideUp("slow");var a=$("a.moreofuser");for(var c=0;c<a.length;c++){var d=$(a)[c];if(this!=d){$(d).attr("show","more");var b=$(d).attr("cnt")+" more&gt;&gt;&nbsp;&nbsp;";$(d).html(b)}}var h=$(this).parent().parent().parent().parent().parent().nextUntil("div.parent");var f=$(this).attr("show");for(var c=0;c<h.length;c++){var d=$(h)[c];if($(d).hasClass("child")){if(f=="more"){$(d).slideDown("slow")}else{$(d).slideUp("slow")}}}if(f=="more"){$(this).attr("show","less");$(this).html("less&lt;&lt;&nbsp;&nbsp;")}else{$(this).attr("show","more");var b=$(this).attr("cnt")+" more&gt;&gt;&nbsp;&nbsp;";$(this).html(b)}};function initTweetUI(){var a=$("#tweets");$("div.body",a).hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")});$("span.prevbt,span.respbt",a).click(function(c){var d=this.getAttribute("id").replace(/^(prev|resp)_/,"");var b=toggleTweetByID(d);b.toggle();postToggle(d,b);c.preventDefault();return false});$("div.body td.action span").parent().hover(function(){var b=$(this).parentsUntil("div.body,div.msg").last().parent();$("td.label",b).html($(this).attr("title").split(" ")[0]+" &nbsp; |")},function(){var b=$(this).parentsUntil("div.body,div.msg").last().parent();$("td.label",b).html("")});$("td.text a span.replybt",a).parent().click(replyTweet);$("td.text a span.retweetbt",a).parent().click(retweet);$("a.moreofuser").click(showmore)}function initPortalUI(){if($("div#leftpane div.portal").length>0&&$("div#rightpane div.portal").length>0){return}}$(function(){if(!window.autorefresh){if(!window.isHome){initTweetUI()}initPortalUI()}$("span.expandcollapse,span.collapseexpand").click(function(){var a="#"+this.getAttribute("id").replace(/^(ex|col)_/,"")+"_navigation";$(a).slideToggle("slow");if($(this).hasClass("expandcollapse")){$(this).removeClass("expandcollapse");$(this).addClass("collapseexpand")}else{$(this).removeClass("collapseexpand");$(this).addClass("expandcollapse")}})});(window.modal=function modal(){if($("div#mCont").length==0){$(document.body).append('<div id="mCont"><div class="overlay opac60"></div><div class="loader"></div><div class="info"></div><div class="dialog"><div class="title"></div><div class="content"></div></div></div>')}if($.browser.msie&&$.browser.version=="6.0"){$("div#mCont,div#mCont div.overlay,div#mCont div.loader,div#mCont div.dialog").css("position","absolute")}function a(){var c=$("div#mCont");$("div.overlay",c).css({height:$(document.body).height()+"px",width:$(document.body).width()+"px"});var b=$("div.loader",c);b.css("left",Math.floor(($(document.body).width()-b.outerWidth())/2));var e=$("div.info",c);e.css("left",Math.floor(($(document.body).width()-e.outerWidth())/2));var d=$("div.dialog",c);d.css("left",Math.floor(($(document.body).width()-d.outerWidth())/2));d.css("top",Math.floor(($(window).height()-d.outerHeight())/3))}$(window).resize(a);a();modal.loader={show:function(b){b=b||"loading";$("div#mCont div.loader").html(b);$("div#mCont div.overlay,div#mCont div.loader").show();return modal.loader},hide:function(){$("div#mCont div.overlay,div#mCont div.loader").hide()}};modal.info=function(b,c){if(typeof b!="string"){return}c=c||3000;$("div#mCont div.info").html(b).show().stop().delay(c).slideUp("fast")};modal.promote=function(c,d){if(typeof c!="string"){return}d=(typeof d=="function")?d:(new Function);$("div#mCont div.info").html(c).slideDown("slow");var b=jQuery("<div style='float: right; text-decoration : underline;'>close [x]</div>").click(function(){$("div#mCont div.info").slideUp("fast");d()});$("div#mCont div.info").append(b)};modal.prompt=function(d,c,f){d=d||"input text";c=c||"";f=(typeof f=="function")?f:(new Function);var b=$("div#mCont div.dialog");$("div.title",b).html(d);$("div.content",b).html("<div><textarea>"+c+"</textarea></div><span>char left : <b>"+(140-c.length)+"</b></span><button value='ok'>ok</button><button>cancel</button>");modal.loader.hide();$("div#mCont div.overlay,div#mCont div.dialog").show();var e=$("div.content textarea",b);e.focus().keyup(function(i){var h=$("div.content span b");var g=140-$(this).val().length;h.html(g);if(g>10){h.attr("style","")}else{if(g>=0){h.attr("style","color:#CB8D00;")}else{h.attr("style","color:#EB1500;")}}});$("div.content button",b).click(function(){if($(this).attr("value").toLowerCase()=="ok"){var g=e.val();if(g.length>140){modal.info("text too long");return}f.call(window,g)}$("div#mCont div.overlay,div#mCont div.dialog").hide()})};modal.confirm=function(c,d){c=c||"are you sure";d=(typeof d=="function")?d:(new Function);var b=$("div#mCont div.dialog");$("div.title",b).html("Retweet");$("div.content",b).html("<p>"+c+"</p><button value='ok'>yes</button><button>no</button>");$("div.content button",b).click(function(){if($(this).attr("value").toLowerCase()=="ok"){d.call(window)}$("div#mCont div.overlay,div#mCont div.dialog").hide()});modal.loader.hide();$("div#mCont div.overlay,div#mCont div.dialog").show()}})();function prettyDate(d){var b=Date.parse(d),c=(((new Date()).getTime()-b)/1000),a=Math.floor(c/86400);if(isNaN(a)||a<0||a>=31){return"unknown time ago"}return a==0&&(c<60&&"just now"||c<120&&"1 minute ago"||c<3600&&Math.floor(c/60)+" minutes ago"||c<7200&&"1 hour ago"||c<86400&&Math.floor(c/3600)+" hours ago")||a==1&&"Yesterday"||a<7&&a+" days ago"||a<31&&Math.ceil(a/7)+" weeks ago"}if(typeof jQuery!="undefined"){jQuery.fn.prettyDate=function(){return this.each(function(){var a=prettyDate($(this).attr("data-timestamp")?$(this).attr("data-timestamp"):this.title);if(a){jQuery(this).text(a)}})}};function prettyDate(d){var b=Date.parse(d),c=(((new Date()).getTime()-b)/1000),a=Math.floor(c/86400);if(isNaN(a)||a<0||a>=31){return"unknown time ago"}return a==0&&(c<60&&"just now"||c<120&&"1 minute ago"||c<3600&&Math.floor(c/60)+" minutes ago"||c<7200&&"1 hour ago"||c<86400&&Math.floor(c/3600)+" hours ago")||a==1&&"Yesterday"||a<7&&a+" days ago"||a<31&&Math.ceil(a/7)+" weeks ago"}if(typeof jQuery!="undefined"){jQuery.fn.prettyDate=function(){return this.each(function(){var a=$(this).attr("data-timestamp")?$(this).attr("data-timestamp"):this.title;if(a){a=prettyDate(a);jQuery(this).text(a)}})}};$(function(){$("span.action a span.replybt").parent().click(replyTweet);$("span.action a span.retweetbt").parent().click(retweet);$("span.replybt").click(replyTweet);$(".time, .timestamp").prettyDate();$("#prominentreply").click(function(){$("#prominentreply").removeClass("tabnavnotselected");$("#prominentreply").addClass("tabnavselected");$("#relevantreply").removeClass("tabnavselected");$("#relevantreply").addClass("tabnavnotselected");$("#allreply").removeClass("tabnavselected");$("#allreply").addClass("tabnavnotselected");$("#pre"+currentTweetId).html("<span class='loading round-corner'>Loading</span>");var a={r:"main/lookup",id:currentTweetId,reply_count:20,enable_more_btn:1,prominent:1};$.get(window.makeurl(a),function(b){$("#pre"+currentTweetId).html(b)},"html");return false});$("#allreply").click(function(){$("#allreply").removeClass("tabnavnotselected");$("#allreply").addClass("tabnavselected");$("#relevantreply").removeClass("tabnavselected");$("#relevantreply").addClass("tabnavnotselected");$("#prominentreply").removeClass("tabnavselected");$("#prominentreply").addClass("tabnavnotselected");$("#pre"+currentTweetId).html("<span class='loading round-corner'>Loading</span>");var a={r:"main/lookup",id:currentTweetId,reply_count:20,enable_more_btn:1,prominent:0};$.get(window.makeurl(a),function(b){$("#pre"+currentTweetId).html(b)},"html");return false});$("#relevantreply").click(function(){$("#relevantreply").removeClass("tabnavnotselected");$("#relevantreply").addClass("tabnavselected");$("#allreply").removeClass("tabnavselected");$("#allreply").addClass("tabnavnotselected");$("#prominentreply").removeClass("tabnavselected");$("#prominentreply").addClass("tabnavnotselected");$("#pre"+currentTweetId).html("<span class='loading round-corner'>Loading</span>");var a={r:"main/lookup",id:currentTweetId,reply_count:20,enable_more_btn:1,userid:currentUserId};$.get(window.makeurl(a),function(b){$("#pre"+currentTweetId).html(b)},"html");return false});$(".twtmore").click(function(){var a=$(this);var c=a.attr("id");$("#morebutton").html('<div class="loading round-corner">loading</div>');var b={r:"main/lookup",id:currentTweetId,start:c,reply_count:20,enable_more_btn:1,prominent:0};$.get(window.makeurl(b),function(d){$("#morebutton").remove();$("#more_updates"+currentTweetId).append(d)},"html");return false})});
